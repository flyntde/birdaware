var nearbyRecentObservations=function(o){var c;var f=$("#search_form");var m=$("#location");var n=$("#location-clear");function g(){var v=new google.maps.LatLng(o.startLat,o.startLng);
var r=document.getElementById("map-canvas");var s={center:v,zoom:o.zoomLevel,mapTypeId:google.maps.MapTypeId.TERRAIN};c=new google.maps.Map(r,s);var p=document.createElement("div");
var u=new MarkerControl(p,c);p.index=1;c.controls[google.maps.ControlPosition.TOP_RIGHT].push(p);var q=document.getElementById("location");var t=new google.maps.places.Autocomplete(q);
t.bindTo("bounds",c);google.maps.event.addListener(t,"place_changed",function(){q.className="";var w=t.getPlace();if(!w.geometry){q.className="not found";
return;}changePlace(c,w.geometry.location,o.lat,o.lng,o.adjustZoomLevel);f.trigger("submit");j(w.geometry.location);});google.maps.event.addListener(c,"click",function(w){changePlace(c,w.latLng,o.lat,o.lng,o.adjustZoomLevel);
j(w.latLng);n.trigger("click");f.trigger("submit");});}google.maps.event.addDomListener(window,"load",g);var d;var l=$("#dist");var j=function(q){if(d){d.setMap(null);
}var p={center:q,fillColor:"#700000",fillOpacity:0.2,map:c,radius:l.val()*1000,strokeWeight:1,clickable:false,draggable:false};d=new google.maps.Circle(p);
};var e={init:function(p,s,r){this.url=p.url;this.params=s;this.template=p.template;this.container=p.container;var q=$.parseQuery(s);this.latLng=new google.maps.LatLng(q.lat,q.lng);
r(this.latLng);this.fetch();},attachTemplate:function(){var p=Handlebars.compile(this.template);this.container.html(p(this.sightings));$("#sightings").click("a",function(u){var v=$(u.target).attr("href");
var s=$.parseQuery(v);var t=new google.maps.LatLng(s.lat,s.lng);var q=new google.maps.Marker({position:t,map:c,title:s.comName+": "+s.obsDt});var r=new google.maps.InfoWindow({content:"<p><strong>"+s.comName+"</strong></p><p> date & time: "+s.obsDt+"</p><p> how many: "+s.howMany+"</p><p> location: "+s.locName+"</p><p> reviewed?: "+s.obsReviewed+"</p><p> valid?: "+s.obsValid+"</p>"});
google.maps.event.addListener(q,"click",function(){r.open(c,q);});k.push(q);u.preventDefault();});},searchEbird:function(){return $.ajax({url:this.url,data:this.params,dataType:"jsonp"}).promise();
},fetch:function(){var p=this;$("#ajax-loader").css("display","inline");this.searchEbird().done(function(q){p.sightings=$.map(q,function(s,r){return{comName:s.comName,sciName:s.sciName,howMany:s.howMany,lat:s.lat,lng:s.lng,locName:s.locName,obsDt:s.obsDt,obsReviewed:s.obsReviewed,obsValid:s.obsValid};
});$("#ajax-loader").css("display","none");p.attachTemplate();});}};var k=[];google.maps.Map.prototype.clearMarkers=function(){for(var p=0;p<k.length;p++){k[p].setMap(null);
}};f.on("submit",function(q){if(m.val()===""&&$("#lat").val()===""){alert("Enter location or click on map");return;}var p=$(this).serialize()+"&fmt=json";
e.init(o,p,j);q.preventDefault();});var h=$("#panel-hide");var i=$("#query-panel");var b=$("#show-panel");var a=$(".sightings-content-inner");h.on("click",function(p){i.slideToggle("fast");
b.addClass("arrow-down");a.height("80%");p.preventDefault();});b.click(function(p){i.slideToggle("fast");b.removeClass("arrow-down");a.height("70%");p.preventDefault();
});textclear(m,n);};