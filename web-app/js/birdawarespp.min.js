var query_ebird=function(c){var f;var g=$("#search_form");function e(){var n=new google.maps.LatLng(c.startLat,c.startLng);var j=document.getElementById("map-canvas");
var k={center:n,zoom:c.zoomLevel,mapTypeId:google.maps.MapTypeId.TERRAIN};f=new google.maps.Map(j,k);var h=document.createElement("div");var m=new MarkerControl(h,f);
h.index=1;f.controls[google.maps.ControlPosition.TOP_RIGHT].push(h);var i=document.getElementById("location");var l=new google.maps.places.Autocomplete(i);
l.bindTo("bounds",f);google.maps.event.addListener(l,"place_changed",function(){i.className="";var o=l.getPlace();if(!o.geometry){i.className="not found";
return;}changePlace(f,o.geometry.location,c.lat,c.lng);g.trigger("submit");});google.maps.event.addListener(f,"click",function(o){changePlace(f,o.latLng,c.lat,c.lng);
g.trigger("submit");});}google.maps.event.addDomListener(window,"load",e);var a=[];google.maps.Map.prototype.clearMarkers=function(){for(var h=0;h<a.length;
h++){a[h].setMap(null);}};var d={init:function(h,j){this.url=h.url;this.params=j;var i=$.parseQuery(j);this.fetch();},searchEbird:function(){return $.ajax({url:this.url,data:this.params,dataType:"jsonp"}).promise();
},fetch:function(){var h=this;this.searchEbird().done(function(i){$.each(i,function(k,n){var m=new google.maps.LatLng(n.lat,n.lng);var j=new google.maps.Marker({position:m,map:f,title:n.comName+": "+n.obsDt});
var l=new google.maps.InfoWindow({content:"<p><strong>"+n.comName+"</strong></p><p> date & time: "+n.obsDt+"</p><p> how many: "+n.howMany+"</p><p> location: "+n.locName+"</p><p> reviewed?: "+n.obsReviewed+"</p><p> valid?: "+n.obsValid+"</p>"});
google.maps.event.addListener(j,"click",function(){l.open(f,j);});a.push(j);});});}};textclear($("#sci"),$("#findspp-clear"));textclear($("#location"),$("#loc-clear"));
var b=function(h){return $.ajax({url:"species/getSpp",type:"GET",data:{name:h},dataType:"jsonp",async:false});};$(".typeahead").typeahead({source:function(i,j){var h=[];
b(i).done(function(k){$.each(k,function(l,m){h.push(m);});j(h);}).fail(function(l,k,m){console.log(l.statusText);console.log(l.responseText);console.log(l.status);
console.log(k);console.log(m);});},items:30,minLength:3});g.on("submit",function(j){if($("#location").val()===""&&$("#lat").val()===""){alert("Enter location or click on map");
return;}var h=$(this).serializeArray();var i="";$.each(h,function(k,l){if(l.name==="sci"){var n=$("#sci").val().split(" - ");l.value=n[1];}var m=l.name+"="+l.value;
if(l.name!=="location"){i+=(k===0)?m:"&"+m;}});i+="&includeProvisional=true&hotspot=false&fmt=json";d.init(c,i);j.preventDefault();});};